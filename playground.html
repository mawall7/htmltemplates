<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    .box {
      width: 200px;
      height: 60px;
      display: grid;
      place-items: center;
      border: 1px solid #ccc;
      margin: 5px;
    }
  </style>
  <title>Clean Orders</title>
</head>
<body>
  <h5>Orders In</h5>
  <div id="in">
    <div id="order-1" class="box">order 1</div>
    <div id="order-2" class="box">order 2</div>
    <div id="order-3" class="box">order 3</div>
  </div>

  <h5>Orders Out</h5>
  <div id="out">

  </div>

  <script>
    // Global persistent mock order list
    const ordersList = [
      { orderNr: 1, name: "order1", isReady: true },
      { orderNr: 2, name: "order2", isReady: true },
      { orderNr: 3, name: "order3", isReady: true }
    ];

    function fetchNextOrder() {
      return ordersList.length > 0 ? ordersList.pop() : null;
    }

    function getInOrderElement(orderNr) {
      const $order = $(`#order-${orderNr}`);
      return $order.length ? $order : null;
    }

    function getNextOrder() {
      const orderData = fetchNextOrder();
      if (!orderData) return null;

      return new Promise((resolve, reject) => {
        const interval = setInterval(() => {
          if (orderData.isReady) {
            clearInterval(interval);
            const $orderEl = getInOrderElement(orderData.orderNr);
            $orderEl ? resolve($orderEl) : reject("DOM element not found");
          }
          if(orderData.ishandled){ resolve($orderE1)}//..} etc
        }, 10);
      });
    }

    async function processOrders() {
      setInterval(async () => {
        const order = await getNextOrder();
        if (order) {
          $("#out").append(order);
          console.log("Moved:", order.text());
        }
      }, 4000);
    }

    const run = async () => {
       const order = await getNextOrder();
       if (order) $("#out").append(order);
       setTimeout(run, 4000); // Call recursively to avoid the loop could overlap if getNextOder takes longer than 4 s you could mutate over a shred state , but there is no lock in js on lists etc. there may be a racing condition.
    };

    run(); // Starts it


    //processOrders();
  </script>
</body>
</html>
